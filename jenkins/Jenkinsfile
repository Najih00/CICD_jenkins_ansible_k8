pipeline {
    agent any

    stages {
        stage('Deploy with Ansible') {
            steps {
                // Checkout code from GitHub repository
                checkout scm

                // Retrieve kubeconfig file using withCredentials
                withCredentials([file(credentialsId: 'kubeconfig-file', variable: 'KUBECONFIG')]) {
                    // Run ansible playbook and pass kubeconfig_path variable
                    sh "ansible-playbook -vvv ansible/deploy.yaml --extra-vars 'kubeconfig_path=${env.KUBECONFIG}'"
                }
            }
        }
    }
}